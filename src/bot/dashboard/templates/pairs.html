{% extends "base.html" %}

{% block title %}Pair Explorer | Funding Rate Arbitrage{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header row with title and date range buttons -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <h2 class="text-2xl font-bold text-white">Pair Explorer</h2>
        <div class="flex items-center gap-2" id="range-buttons">
            <button data-range="7d" class="px-3 py-1.5 text-sm rounded bg-dash-card text-gray-400 border border-dash-border hover:text-white">7D</button>
            <button data-range="30d" class="px-3 py-1.5 text-sm rounded bg-dash-card text-gray-400 border border-dash-border hover:text-white">30D</button>
            <button data-range="90d" class="px-3 py-1.5 text-sm rounded bg-dash-card text-gray-400 border border-dash-border hover:text-white">90D</button>
            <button data-range="all" class="px-3 py-1.5 text-sm rounded bg-blue-600 text-white">All</button>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="ranking-loading" class="text-center py-12">
        <div class="animate-spin inline-block w-8 h-8 border-2 border-gray-500 border-t-blue-500 rounded-full"></div>
        <p class="text-gray-400 mt-3">Loading pair data...</p>
    </div>

    <!-- Ranking Table -->
    <div id="ranking-section" class="hidden bg-dash-card rounded-lg border border-dash-border p-4 overflow-x-auto">
        <table class="w-full text-sm">
            <thead>
                <tr class="text-gray-400 border-b border-dash-border">
                    <th class="text-left py-2 px-2">#</th>
                    <th class="text-left py-2 px-2">Pair</th>
                    <th class="text-right py-2 px-2">Records</th>
                    <th class="text-right py-2 px-2">Avg Rate</th>
                    <th class="text-right py-2 px-2">Median</th>
                    <th class="text-right py-2 px-2">Std Dev</th>
                    <th class="text-right py-2 px-2">% Positive</th>
                    <th class="text-right py-2 px-2">Net Yield/Period</th>
                    <th class="text-right py-2 px-2">Ann. Yield</th>
                </tr>
            </thead>
            <tbody id="ranking-body"></tbody>
        </table>
    </div>

    <!-- Empty State -->
    <div id="empty-state" class="hidden text-center py-12">
        <p class="text-gray-400 text-lg">No pair data available.</p>
        <p class="text-gray-500 text-sm mt-2">Start historical data collection to see pair rankings.</p>
    </div>

    <!-- Per-Pair Detail Section (hidden initially) -->
    <div id="pair-detail" class="hidden space-y-4">
        <div class="flex items-center justify-between">
            <h3 class="text-xl font-semibold text-white" id="detail-title"></h3>
            <button id="close-detail" class="text-gray-400 hover:text-white text-sm px-3 py-1 rounded border border-dash-border hover:border-gray-500">Close</button>
        </div>

        <!-- Stats Grid -->
        <div id="detail-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <!-- Filled by JS -->
        </div>

        <!-- Chart Container -->
        <div id="chart-container" class="hidden bg-dash-card rounded-lg border border-dash-border p-4">
            <h4 class="text-white font-semibold mb-2">Funding Rate History</h4>
            <div style="position: relative; height: 300px;">
                <canvas id="funding-rate-chart"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{% endblock %}
